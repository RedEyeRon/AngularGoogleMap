var ngPopup=angular.module("ngPopup",[]);ngPopup.directive("ngPopUp",function($parse,$document,$templateCache,$compile,ngPopupBuilder){return{restrict:"EA",scope:!0,replace:!0,template:'<div class="ngPopup" ng-show="_option.isShow"></div>',link:function(scope,element,attrs){var $element=element[0],$option=null==scope.$parent.$eval(attrs.option)?ngPopupBuilder.getDefaultOptions():scope.$parent.$eval(attrs.option),modelName=$parse($option.modelName),dragStartFlag=!1,resizeStartFlag=!1,html=ngPopupBuilder.layoutInit($option,attrs.option),compiledHtml=$compile(html)(scope.$parent);scope._option=$option,scope.$watch(attrs.option,function(newValue,oldValue){if($element.style.position="absolute",scope.$parent.$eval($option.modelName).isMinimized()||ngPopupBuilder.updateElementSize(element,newValue.width,newValue.height),$element.style.top=newValue.position.top+"px",$element.style.left=newValue.position.left+"px",$element.getElementsByClassName("title")[0].innerHTML=newValue.title,newValue.isShow!=oldValue.isShow&&(newValue.isShow?newValue.onOpen():newValue.onClose()),(newValue.width!=oldValue.width||newValue.height!=oldValue.height)&&newValue.onResize&&newValue.onResize(),newValue.hasTitleBar!=oldValue.hasTitleBar){var html=ngPopupBuilder.layoutInit($option,attrs.option),compiledHtml=$compile(html)(scope.$parent);element.empty(),element.append(compiledHtml)}},!0),modelName.assign(scope.$parent,ngPopupBuilder.getDefaultMethods($option,element,scope.$parent)),element.append(compiledHtml),element.bind("mousedown",function(event){var target=angular.element(event.target),targetTop=parseFloat(window.getComputedStyle($element,null).top),targetLeft=parseFloat(window.getComputedStyle($element,null).left),targetHeight=parseFloat(window.getComputedStyle($element,null).height),targetWidth=parseFloat(window.getComputedStyle($element,null).width),origY=event.pageY,origX=event.pageX;if(target.hasClass("titleBar")||target.hasClass("title")||target.parent().hasClass("contentNoBar")){if(0==$option.draggable)return;$option.onDragStart&&($option.onDragStart(),dragStartFlag=!0),$document.find("body").addClass("unselectable"),$document.bind("mousemove",function(event){$element.style.top=event.pageY-origY+targetTop+"px",$element.style.left=event.pageX-origX+targetLeft+"px",ngPopupBuilder.updateParentScopeOptions($option,element),ngPopupBuilder.callParentScopeApply(scope.$parent)})}if(target.parent().hasClass("resizeCorner")){if(0==$option.resizable)return void $document.find("body").removeClass("unselectable");$option.onResize&&($option.onResize(),resizeStartFlag=!0),$document.find("body").addClass("unselectable"),target.hasClass("right-bottom-corner")?$document.bind("mousemove",function(event){$element.style.height=event.pageY-targetTop+"px",$element.style.width=event.pageX-targetLeft+"px",ngPopupBuilder.updateParentScopeOptions($option,element),ngPopupBuilder.callParentScopeApply(scope.$parent)}):target.hasClass("right-top-corner")?$document.bind("mousemove",function(event){$element.style.top=event.pageY+"px",$element.style.width=targetWidth+event.pageX-origX+"px",$element.style.height=targetHeight-event.pageY+origY+"px",ngPopupBuilder.updateParentScopeOptions($option,element),ngPopupBuilder.callParentScopeApply(scope.$parent)}):target.hasClass("left-top-corner")?$document.bind("mousemove",function(event){$element.style.left=event.pageX+"px",$element.style.top=event.pageY+"px",$element.style.width=targetWidth-event.pageX+origX+"px",$element.style.height=targetHeight-event.pageY+origY+"px",ngPopupBuilder.updateParentScopeOptions($option,element),ngPopupBuilder.callParentScopeApply(scope.$parent)}):target.hasClass("left-bottom-corner")&&$document.bind("mousemove",function(event){$element.style.left=event.pageX+"px",$element.style.width=targetWidth-event.pageX+origX+"px",$element.style.height=targetHeight+event.pageY-origY+"px",ngPopupBuilder.updateParentScopeOptions($option,element),ngPopupBuilder.callParentScopeApply(scope.$parent)})}if(target.parent().hasClass("resizeBar")){if(0==$option.resizable)return void $document.find("body").removeClass("unselectable");$option.onResize&&($option.onResize(),resizeStartFlag=!0),$document.find("body").addClass("unselectable"),target.hasClass("left-bar")?$document.bind("mousemove",function(event){$element.style.left=targetLeft+event.pageX-origX+"px",$element.style.width=targetWidth-event.pageX+origX+"px",ngPopupBuilder.updateParentScopeOptions($option,element),ngPopupBuilder.callParentScopeApply(scope.$parent)}):target.hasClass("right-bar")?$document.bind("mousemove",function(event){$element.style.width=targetWidth+event.pageX-origX+"px",ngPopupBuilder.updateParentScopeOptions($option,element),ngPopupBuilder.callParentScopeApply(scope.$parent)}):target.hasClass("top-bar")?$document.bind("mousemove",function(event){$element.style.top=event.pageY+"px",$element.style.height=targetHeight-event.pageY+origY+"px",ngPopupBuilder.updateParentScopeOptions($option,element),ngPopupBuilder.callParentScopeApply(scope.$parent)}):target.hasClass("bottom-bar")&&$document.bind("mousemove",function(event){$element.style.height=targetHeight+event.pageY-origY+"px",ngPopupBuilder.updateParentScopeOptions($option,element),ngPopupBuilder.callParentScopeApply(scope.$parent)})}}),element.bind("mouseup",function(){$option.onDragEnd&&dragStartFlag&&($option.onDragEnd(),dragStartFlag=!1,resizeStartFlag=!1),$document.find("body").removeClass("unselectable"),$document.unbind("mousemove")})}}}),ngPopup.factory("ngPopupBuilder",function(){var ngPopupBuilder={layoutInit:function(option,optionName){var templateHtml=option.template?option.template:"",templateUrlHtml="",html=null;if(option.templateUrl){var xmlHttpRequest=new XMLHttpRequest;xmlHttpRequest.onreadystatechange=function(){4==xmlHttpRequest.readyState&&200==xmlHttpRequest.status&&(templateUrlHtml=xmlHttpRequest.responseText)},xmlHttpRequest.open("GET",option.templateUrl,!1),xmlHttpRequest.send(null)}return html='<div class="container"><div class="resizeCorner"><div class="left-top-corner"></div><div class="left-bottom-corner"></div><div class="right-top-corner"></div><div class="right-bottom-corner"></div></div><div class="resizeBar"><div class="top-bar"></div><div class="right-bar"></div><div class="bottom-bar"></div><div class="left-bar"></div></div><div class="titleBar" ng-show="{{'+optionName+".hasTitleBar || !"+optionName+'.hasOwnProperty(&quot;hasTitleBar&quot;)}}"><span class="title">'+option.title+'</span><div class="iconGroup"><span class="glyphicon glyphicon-minus" ng-click='+option.modelName+'.minimize($event)></span><span class="glyphicon glyphicon-fullscreen" ng-click='+option.modelName+'.maximize()></span><span class="glyphicon glyphicon-resize-small" ng-click='+option.modelName+'.togglePin($event)></span><span class="glyphicon glyphicon-remove" ng-click= '+option.modelName+'.close()></span></div></div><div class="content" ng-class="{contentNoBar:{{!'+optionName+".hasTitleBar &&"+optionName+'.hasOwnProperty(&quot;hasTitleBar&quot;)}} }">'+templateHtml+templateUrlHtml+"</div></div>"},getDefaultMethods:function(options,element){var $element=element[0],fun={open:function(newPosition){null!=newPosition&&($element.style.top=newPosition.top+"px",$element.style.left=newPosition.left+"px"),options.onOpen&&options.onOpen(),options.isShow=!0},close:function(){options.onClose&&options.onClose(),options.isShow=!1},maximize:function(){$element.getElementsByClassName("content")[0].style.display="block",$element.style.top=window.screenTop?window.screenTop:window.screenY+10+"px",$element.style.left=window.screenLeft?window.screenLeft:window.screenX+10+"px",$element.style.width=window.innerWidth-30+"px",$element.style.height=window.innerHeight-30+"px",options.position.top=$element.offsetTop,options.position.left=$element.offsetLeft,options.width=$element.offsetWidth,options.height=$element.offsetHeight},minimize:function(event){"none"!=$element.getElementsByClassName("content")[0].style.display?($element.getElementsByClassName("content")[0].style.display="none",$element.style.height=$element.getElementsByClassName("titleBar")[0].style.height,$element.style.width="200px",angular.element(event.target).removeClass("glyphicon-minus"),angular.element(event.target).addClass("glyphicon-plus")):($element.style.height=options.height+"px",$element.style.width=options.width+"px",$element.style.top=options.position.top+"px",$element.style.left=options.position.left+"px",$element.getElementsByClassName("content")[0].style.display="block",angular.element(event.target).removeClass("glyphicon-plus"),angular.element(event.target).addClass("glyphicon-minus"),options.position.top=$element.offsetTop,options.position.left=$element.offsetLeft)},togglePin:function(event){1!=$option.pinned?($element.style.position="fixed",angular.element(event.target).removeClass("glyphicon-resize-small"),angular.element(event.target).addClass("glyphicon-resize-full"),options.pinned=!0):($element.style.position="absolute",angular.element(event.target).removeClass("glyphicon-resize-full"),angular.element(event.target).addClass("glyphicon-resize-small"),options.pinned=!1)},setTitle:function(newTitle){$element.getElementsByClassName("title")[0].innerHTML=newTitle},isOpened:function(){return"none"!=$element.style.display?!0:!1},isMaximized:function(){},isMinimized:function(){return"none"!=$element.getElementsByClassName("content")[0].style.display?!1:!0}};return fun},getDefaultOptions:function(){var defaultOption={modelName:"",width:100,height:100,template:"123",templateUrl:"",resizable:!0,draggable:!0,position:{top:100,left:100},title:"",modal:!1,pinned:!1,isShow:!0,effect:"fade",onOpen:function(){},onClose:function(){},onDragStart:function(){},onDragEnd:function(){},onResize:function(){}};return defaultOption},callParentScopeApply:function(scope){scope.$$phase||scope.$apply()},updateParentScopeOptions:function(options,element){var $element=element[0];options.position.top=$element.offsetTop,options.position.left=$element.offsetLeft,"none"!=$element.getElementsByClassName("content")[0].style.display&&(options.width=$element.offsetWidth,options.height=$element.offsetHeight)},updateElementSize:function(element,width,height){var $element=element[0];"string"==typeof width&&($element.style.width=width),"number"==typeof width&&($element.style.width=width+"px"),"string"==typeof height&&($element.style.height=height),"number"==typeof height&&($element.style.height=height+"px")},updateElementPosition:function(element,position){var $element=element[0];"string"==typeof position.top&&($element.style.top=position.top),"number"==typeof position.top&&($element.style.top=position.top+"px"),"string"==typeof position.left&&($element.style.left=position.left),"number"==typeof position.left&&($element.style.left=position.left+"px")}};return ngPopupBuilder});